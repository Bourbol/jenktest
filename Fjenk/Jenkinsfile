properties ([disableConcurrentBuilds()])

pipeline {
    agent any
    options {
        timestamps()
    }
    triggers { pollSCM("* * * * *") }
    stages {
        stage("Dockerhub login") {
            steps {
                withCredentials([usernamePassword(credentialsId: "dockerhub_cred", usernameVariable: "USER", passwordVariable: "PASSWORD")]) {
                sh "docker login -u $USER -p $PASSWORD"
                }
            }
        }
        stage("Docker build") {
            steps {
                echo "======= Build docker image ======="
                dir("Docker/") {
                sh "docker build -t bourbol/tinytoss:3.14 ."
                }
            }
        }
        stage("Docker push") {
            steps {
            sh "docker push bourbol/tinytoss:3.14"
            }
        }
    }
}
